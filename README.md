# Программа для детекции объектов на видео с использованием YOLO

## Описание

Программа для извлечений кадров из видео, выполняет детекцию объектов с помощью модели YOLO, рисует bbox (рамки) вокруг обнаруженных объектов, и сохраняет обработанные кадры в структуру папок, разделенную по классам.

## Основные возможности

- Выбор классов для детекции:
    * человек
    * велосипед
    * автомобиль
    * мотоцикл
    * самолет
    * автобус
    * поезд
    * грузовик
- Режимы выборки кадров:
  - `random` — случайные кадры.
  - `interval` — равномерно распределённые кадры из указанного интервала времени.
- Поддержка изменения размера изображений.
- Сохранение кадров с рамками (bbox) и без них.
- Автоматическое создание отчёта с результатами детекции.

## Установка
1. Склонируйте репозиторий:
   ```bash
   git clone https://github.com/
   ```
2. Перейдите в папку проекта:
   ```bash
   cd <project>
   ```
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

## Запуск

Для запуска программы выполните команду:
```bash
python object_detection.py
```

### Взаимодействие с программой

1. Введите путь к видеофайлу и папке для сохранения кадров.
2. Укажите путь к весам модели YOLO (или используйте значения по умолчанию).
3. Выберите классы объектов для детекции.
4. Укажите режим работы (`random` или `interval`) и доп. параметры.
5. Программа начнёт обработку и сохранит результаты в указанной папке.

## Тестирование

Для запуска тестов выполните:
```bash
pytest
```

### Тесты включают проверку следующих функций:

1. **Тестирование функции `detect_objects`**:
    - **Положительный случай** (`test_detect_objects_positive`):
        - Мокаем объект модели и возвращаем предсказания с одним объектом (автомобиль) с уверенность 0.9.
        - Проверяется, что функция `detect_objects` правильно детектирует 1 объект и возвращает его данные: класс 2 (автомобиль), уверенность 0.9 и координаты.
    - **Отрицательный случай** (`test_detect_objects_negative`):
        - Мокаем модель, возвращаем пустой результат (без объектов).
        - Проверяется, что функция возвращает пустой список, т.к. объектов не найдено.

2. **Тестирование функции `save_frame`**:
    - **Положительный случай** (`test_save_frame_positive`):
        - Мокаем `os.makedirs` и `cv2.imwrite` для проверки создания директорий и сохранения файла.
        - Проверяется, что функции были вызваны с правильными параметрами и директорией для объекта с классом 2 (автомобиль).
    - **Отрицательный случай** (`test_save_frame_negative`):
        - Мокаем ошибку при сохранении изображения с помощью `mock_imwrite.side_effect`.
        - Проверяется, что ошибка при сохранении корректно обрабатывается и выбрасывается исключение.

3. **Тестирование функции `load_model`**:
    - **Положительный случай** (`test_load_model_positive`):
        - Мокаем функцию загрузки модели и проверяем, что она возвращает правильную модель.
    - **Отрицательный случай** (`test_load_model_negative`):
        - Мокаем ошибку при попытке загрузки несуществующей модели и проверяем, что выбрасывается исключение с соответствующим сообщением.

4. **Тестирование переменной `names_class`**:
    - **Положительный случай** (`test_names_class_positive`):
        - Проверяется, что `names_class` является словарем, ключи которого — целые числа, а значения — строки.
    - **Отрицательный случай** (`test_names_class_negative`):
        - Проверяется, что некорректная структура данных вызывает ошибку.

5. **Тестирование функции `draw_boxes`**:
    - **Положительный случай** (`test_draw_boxes_positive`):
        - Мокаем модель и проверяем, что функция `draw_boxes` рисует рамки на изображении, возвращая изображение с теми же размерами.
    - **Отрицательный случай** (`test_draw_boxes_negative`):
        - Проверяется, что если список детекций пустой, функция возвращает изображение без изменений.

---

## Структура выходных данных

После выполнения программы в указанной папке будет создана следующая структура:
```
output_folder/
├── человек/
│   ├── frame_0001.jpg
│   └── frame_0002.jpg
├── автомобиль/
│   ├── frame_0001.jpg
│   └── frame_0003.jpg
├── frame_0001_with_boxes.jpg
├── frame_0002_with_boxes.jpg
└── report.txt
```

```